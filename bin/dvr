#!/usr/bin/env ruby -wKU

require 'yaml'

ENV[ 'DVR_DIR' ] ||= '.'

command  = ARGV.join ' '
output   = %x{#{command}}
filename = command.gsub %r{\W+}, '_'
filepath = File.join ENV[ 'DVR_DIR' ], "#{filename}.yml"

File.open filepath, 'w' do |f|
  f.puts YAML.dump \
    :command    => command,
    :output     => output,
    :exitstatus => $?.exitstatus
end
