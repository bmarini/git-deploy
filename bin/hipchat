#!/usr/bin/env ruby -KU

require 'thor'
require 'net/https'

class Hipchat < Thor

  desc 'say [MESSAGE]', 'Say a thing to a room, like "wassup?"'

  method_option :auth_token, :required => true
  method_option :room_id,    :required => true
  method_option :from,       :required => true
  method_option :notify,     :type => :boolean, :default => '1'
  method_option :color,      :type => :string

  def say( message='wassup?' )
    uri  = URI 'https://api.hipchat.com/v1/rooms/message'

    req  = Net::HTTP::Post.new uri.path
    req.set_form_data options.merge( 'message' => message )

    http = Net::HTTP.new uri.host, uri.port
    http.use_ssl = true

    http.request req
  end
end

Hipchat.start
